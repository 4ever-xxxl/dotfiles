# ~/.tmux.conf

#═════════════════════════════════════════════════════════════════════════════
# 全局选项 (Global Options)
#═════════════════════════════════════════════════════════════════════════════

# 1. 基础设置
#─────────────────────────────────────────────────────────────────────────────

# 前缀键配置
# 将前缀键由 C-b 改为 C-a (Ctrl+a)，C-a 更顺手且不易冲突
unbind C-b
set-option -g prefix C-a
bind-key C-a send-prefix

# 鼠标支持
# 允许使用鼠标选择窗格、调整大小、滚动等
set -g mouse on

# 历史记录
# 设置更长的历史记录行数
set -g history-limit 10000

# 终端颜色
# 设置终端颜色为 256 色，以获得更好的视觉体验
set -g default-terminal "screen-256color"
set -ag terminal-overrides ",xterm-256color:RGB"

# 响应延迟
# 降低命令响应延迟，使操作更流畅
set -sg escape-time 0

# 窗口索引
# 窗口和窗格索引从 1 开始（更符合键盘布局）
set -g base-index 1
setw -g pane-base-index 1

# 窗口编号
# 关闭窗口后自动重新编号
set -g renumber-windows on

# 窗口标题
# 允许自动重命名窗口
setw -g automatic-rename on
set -g set-titles on

# 窗口活动监视
setw -g monitor-activity on
set -g visual-activity off



#═════════════════════════════════════════════════════════════════════════════
# 键位绑定 (Key Bindings)
#═════════════════════════════════════════════════════════════════════════════
# 您现在的前缀键是 `Ctrl + a`

# 1. 窗口与窗格操作
#─────────────────────────────────────────────────────────────────────────────

# 分割窗口
# 使用 | 和 - 分割窗口，并在当前目录下创建
bind | split-window -h -c "#{pane_current_path}"
bind - split-window -v -c "#{pane_current_path}"

# 也可以使用 \ 和 _ 作为替代（无需 Shift）
bind \\ split-window -h -c "#{pane_current_path}"
bind _ split-window -v -c "#{pane_current_path}"

# 创建新窗口
# 使用 c 创建新窗口，在当前目录下
bind c new-window -c "#{pane_current_path}"

# 重载配置
# 使用 r 键重载配置文件，无需重启 tmux
bind r source-file ~/.tmux.conf \; display "✓ 配置已重载！"

# 窗格导航
# 使用 Vim 的 hjkl 键在窗格间切换（需前缀键）
bind h select-pane -L
bind j select-pane -D
bind k select-pane -U
bind l select-pane -R

# 使用 Alt+方向键快速切换窗格（无需前缀键）
bind -n M-Left  select-pane -L
bind -n M-Right select-pane -R
bind -n M-Up    select-pane -U
bind -n M-Down  select-pane -D

# 使用 Alt+hjkl 快速切换窗格（无需前缀键）
bind -n M-h select-pane -L
bind -n M-l select-pane -R
bind -n M-k select-pane -U
bind -n M-j select-pane -D

# 快速切换到上一个窗格
bind Tab last-pane

# 调整窗格大小
# 使用 < 和 > 调整窗格宽度
bind -r < resize-pane -L 5
bind -r > resize-pane -R 5

# 使用 HJKL 调整窗格大小（需前缀键，可重复）
bind -r H resize-pane -L 5
bind -r J resize-pane -D 5
bind -r K resize-pane -U 5
bind -r L resize-pane -R 5

# 关闭窗格和窗口
bind-key x kill-pane
bind-key & kill-window
bind-key X kill-window

# 窗口切换
# 使用 Alt+数字 快速跳转到指定窗口（无需前缀键）
bind -n M-1 select-window -t 1
bind -n M-2 select-window -t 2
bind -n M-3 select-window -t 3
bind -n M-4 select-window -t 4
bind -n M-5 select-window -t 5
bind -n M-6 select-window -t 6
bind -n M-7 select-window -t 7
bind -n M-8 select-window -t 8
bind -n M-9 select-window -t 9

# 使用 Alt+n/p 切换下一个/上一个窗口（无需前缀键）
bind -n M-n next-window
bind -n M-p previous-window



# 2. 复制模式
#-----------------------------------------------------------------------------
# [-] 使用 Vim 键位进行复制模式操作
set-window-option -g mode-keys vi

# [-] 使用 [ 进入复制模式，] 粘贴
bind [ copy-mode
bind ] paste-buffer

# [-] `v` 开始选择，`y` 复制到系统剪贴板
# 需要安装 xsel 或 xclip (Linux) / pbcopy (macOS)
bind-key -T copy-mode-vi 'v' send-keys -X begin-selection
bind-key -T copy-mode-vi 'C-v' send-keys -X rectangle-toggle
bind-key -T copy-mode-vi 'y' send-keys -X copy-pipe-and-cancel 'xclip -in -selection clipboard'

# [-] 鼠标选择后自动复制到剪贴板
bind-key -T copy-mode-vi MouseDragEnd1Pane send-keys -X copy-pipe-and-cancel 'xclip -in -selection clipboard'

# 取消复制模式
bind-key -T copy-mode-vi Escape send-keys -X cancel


#═════════════════════════════════════════════════════════════════════════════
# 外观与状态栏 (Appearance & Status Bar)
#═════════════════════════════════════════════════════════════════════════════

# 1. 颜色与主题
#─────────────────────────────────────────────────────────────────────────────

# 状态栏颜色
set -g status-style 'bg=#333333,fg=#AAAAAA'

# 窗口列表颜色
set-window-option -g window-status-style 'fg=#888888'
set-window-option -g window-status-current-style 'fg=#FFFFFF,bg=#222222'

# 窗格边框颜色
set -g pane-border-style 'fg=#555555'
set -g pane-active-border-style 'fg=#FFFFFF'


# 2. 状态栏内容
#-----------------------------------------------------------------------------
# [-] 左侧状态栏：会话名称和窗口信息
set -g status-left-length 40
set -g status-left '#[fg=green,bold]❐ #S #[fg=white]| #[fg=yellow]#I:#P '

# [-] 右侧状态栏：主机名、日期、时间
set -g status-right-length 80
set -g status-right '#[fg=cyan]#H #[fg=white]| #[fg=yellow]%Y-%m-%d #[fg=green]%H:%M:%S '

# [-] 状态栏居中显示窗口列表
set -g status-justify centre

# [-] 更新状态栏的频率（秒）
set -g status-interval 1

# 窗口状态格式
set -g window-status-format ' #I:#W#F '
set -g window-status-current-format ' #I:#W#F '


#═════════════════════════════════════════════════════════════════════════════
# 插件管理 (Plugin Management) - TPM
#═════════════════════════════════════════════════════════════════════════════
# TPM (Tmux Plugin Manager) 是管理插件的最佳方式

# 插件列表
set -g @plugin 'tmux-plugins/tpm'                # 插件管理器
set -g @plugin 'tmux-plugins/tmux-sensible'      # 基础优化
set -g @plugin 'tmux-plugins/tmux-resurrect'     # 保存/恢复会话
set -g @plugin 'dracula/tmux'                    # Dracula 主题（可替换）
# set -g @plugin 'tmux-plugins/tmux-yank'        # 增强复制功能

# Dracula 主题配置（如果使用）
set -g @dracula-plugins "cpu-usage ram-usage"
set -g @dracula-show-powerline true
set -g @dracula-show-left-icon session

# 自动恢复设置
set -g @continuum-restore 'on'

#─────────────────────────────────────────────────────────────────────────────
# 初始化 TPM（必须放在配置文件的最后）
#─────────────────────────────────────────────────────────────────────────────
run '~/.tmux/plugins/tpm/tpm'
run '~/.tmux/plugins/tpm/tpm'
